/*
 * Copyright (c) 2020. - Arash Hatami
 */

!function(){var t,e,n;!function(i){function r(t,e){return x.call(t,e)}function o(t,e){var n,i,r,o,s,a,u,c,f,l,p,d,m=e&&e.split("/"),h=y.map,v=h&&h["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,y.nodeIdCompat&&j.test(t[s])&&(t[s]=t[s].replace(j,"")),"."===t[0].charAt(0)&&m&&(d=m.slice(0,m.length-1),t=d.concat(t)),f=0;f<t.length;f++)if("."===(p=t[f]))t.splice(f,1),f-=1;else if(".."===p){if(0===f||1===f&&".."===t[2]||".."===t[f-1])continue;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}if((m||v)&&h){for(n=t.split("/"),f=n.length;f>0;f-=1){if(i=n.slice(0,f).join("/"),m)for(l=m.length;l>0;l-=1)if((r=h[m.slice(0,l).join("/")])&&(r=r[i])){o=r,a=f;break}if(o)break;!u&&v&&v[i]&&(u=v[i],c=f)}!o&&u&&(o=u,a=c),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function s(t,e){return function(){var n=O.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),m.apply(i,n.concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function u(t){return function(e){g[t]=e}}function c(t){if(r(b,t)){var e=b[t];delete b[t],w[t]=!0,d.apply(i,e)}if(!r(g,t)&&!r(w,t))throw new Error("No "+t);return g[t]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return t?f(t):[]}function p(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,m,h,v,g={},b={},y={},w={},x=Object.prototype.hasOwnProperty,O=[].slice,j=/\.js$/;h=function(t,e){var n,i=f(t),r=i[0],s=e[1];return t=i[1],r&&(r=o(r,s),n=c(r)),r?t=n&&n.normalize?n.normalize(t,a(s)):o(t,s):(t=o(t,s),i=f(t),r=i[0],t=i[1],r&&(n=c(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},v={require:function(t){return s(t)},exports:function(t){var e=g[t];return void 0!==e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:p(t)}}},d=function(t,e,n,o){var a,f,p,d,m,y,x,O=[],j=typeof n;if(o=o||t,y=l(o),"undefined"===j||"function"===j){for(e=!e.length&&n.length?["require","exports","module"]:e,m=0;m<e.length;m+=1)if(d=h(e[m],y),"require"===(f=d.f))O[m]=v.require(t);else if("exports"===f)O[m]=v.exports(t),x=!0;else if("module"===f)a=O[m]=v.module(t);else if(r(g,f)||r(b,f)||r(w,f))O[m]=c(f);else{if(!d.p)throw new Error(t+" missing "+f);d.p.load(d.n,s(o,!0),u(f),{}),O[m]=g[f]}p=n?n.apply(g[t],O):void 0,t&&(a&&a.exports!==i&&a.exports!==g[t]?g[t]=a.exports:p===i&&x||(g[t]=p))}else t&&(g[t]=n)},t=e=m=function(t,e,n,r,o){if("string"==typeof t)return v[t]?v[t](e):c(h(t,l(e)).f);if(!t.splice){if(y=t,y.deps&&m(y.deps,y.callback),!e)return;e.splice?(t=e,e=n,n=null):t=i}return e=e||function(){},"function"==typeof n&&(n=r,r=o),r?d(i,t,e,n):setTimeout(function(){d(i,t,e,n)},4),m},m.config=function(t){return m(t)},t._defined=g,n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),r(g,t)||r(b,t)||(b[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("components/almond/almond",function(){}),n("app/lib/ready",[],function(){"use strict";var t=!1,e=function(e){t||(t=!0,e())};return function(t){document.addEventListener("DOMContentLoaded",function(){e(t)}),"interactive"!==document.readyState&&"complete"!==document.readyState||e(t)}}),n("app/lib/promise",[],function(){"use strict";var t=function(t){console.log(t)},e=function(){this.success=[],this.errors=[]};e.prototype.then=function(e,n){this.success.push(e),n?this.errors.push(n):this.errors.push(t)};var n=function(){this.promise=new e};n.prototype={promise:e,resolve:function(t){this.promise.success.forEach(function(e){window.setTimeout(function(){e(t)},0)})},reject:function(t){this.promise.errors.forEach(function(e){window.setTimeout(function(){e(t)},0)})}};var i=function(t,n){return t instanceof e?t.then(n):n(t)};return{defer:function(){return new n},when:i}}),n("app/globals",[],function(){"use strict";var t=function(){this.values=[]};return t.prototype.update=function(t){this.values.push((new Date).getTime()-t.getTime())},t.prototype.localTime=function(){return new Date((new Date).getTime()-this.values.reduce(function(t,e){return t+e})/this.values.length)},{offset:new t}}),n("app/api",["app/lib/promise","app/globals"],function(t,e){"use strict";for(var n,i,r=function(){return window.location.pathname},o=document.getElementsByTagName("script"),s=0;s<o.length;s++)if(o[s].hasAttribute("data-nikas")){i=o[s].getAttribute("data-nikas");break}if(!i){for(s=0;s<o.length;s++)if(o[s].getAttribute("async")||o[s].getAttribute("defer"))throw"Nikas's automatic configuration detection failed, please refer to client-configuration and add a custom `data-nikas` attribute.";n=o[o.length-1],i=n.src.substring(0,n.src.length-"/js/embed.min.js".length)}"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));var a=function(t,n,i,r,o){function s(){var t=a.getResponseHeader("Date");null!==t&&e.offset.update(new Date(t));var n=a.getResponseHeader("X-Set-Cookie");n&&n.match(/^nikas-/)&&(document.cookie=n),a.status>=500?o&&o(a.body):r({status:a.status,body:a.responseText})}var a=new XMLHttpRequest;try{a.open(t,n,!0),a.withCredentials=!0,a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){4===a.readyState&&s()}}catch(t){(o||console.log)(t.message)}a.send(i)},u=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&null!==t[n]&&void 0!==t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e.substring(0,e.length-1)};return{endpoint:i,salt:"Eech7co8Ohloopo9Ol6baimi",create:function(e,n){var o=t.defer();return a("POST",i+"/new?"+u({uri:e||r()}),JSON.stringify(n),function(t){201===t.status||202===t.status?o.resolve(JSON.parse(t.body)):o.reject(t.body)}),o.promise},modify:function(e,n){var r=t.defer();return a("PUT",i+"/id/"+e,JSON.stringify(n),function(t){403===t.status?r.reject("Not authorized to modify this comment!"):200===t.status?r.resolve(JSON.parse(t.body)):r.reject(t.body)}),r.promise},remove:function(e){var n=t.defer();return a("DELETE",i+"/id/"+e,null,function(t){403===t.status?n.reject("Not authorized to remove this comment!"):200===t.status?n.resolve(null===JSON.parse(t.body)):n.reject(t.body)}),n.promise},view:function(e,n){var r=t.defer();return a("GET",i+"/id/"+e+"?"+u({plain:n}),null,function(t){r.resolve(JSON.parse(t.body))}),r.promise},fetch:function(e,n,o,s,c){void 0===n&&(n="inf"),void 0===o&&(o="inf"),void 0===s&&(s=null);var f={uri:e||r(),after:c,parent:s};"inf"!==n&&(f.limit=n),"inf"!==o&&(f.nested_limit=o);var l=t.defer();return a("GET",i+"/?"+u(f),null,function(t){200===t.status?l.resolve(JSON.parse(t.body)):404===t.status?l.resolve({total_replies:0}):l.reject(t.body)}),l.promise},count:function(e){var n=t.defer();return a("POST",i+"/count",JSON.stringify(e),function(t){200===t.status?n.resolve(JSON.parse(t.body)):n.reject(t.body)}),n.promise},like:function(e){var n=t.defer();return a("POST",i+"/id/"+e+"/like",null,function(t){n.resolve(JSON.parse(t.body))}),n.promise},dislike:function(e){var n=t.defer();return a("POST",i+"/id/"+e+"/dislike",null,function(t){n.resolve(JSON.parse(t.body))}),n.promise},feed:function(t){return i+"/feed?"+u({uri:t||r()})},preview:function(e){var n=t.defer();return a("POST",i+"/preview",JSON.stringify({text:e}),function(t){200===t.status?n.resolve(JSON.parse(t.body).text):n.reject(t.body)}),n.promise}}}),n("app/dom",[],function(){"use strict";function t(t){this.obj=t,this.replace=function(e){var i=n.htmlify(e);return t.parentNode.replaceChild(i.obj,t),i},this.prepend=function(e){var i=n.htmlify(e);return t.insertBefore(i.obj,t.firstChild),i},this.append=function(e){var i=n.htmlify(e);return t.appendChild(i.obj),i},this.insertAfter=function(e){var i=n.htmlify(e);return t.parentNode.insertBefore(i.obj,t.nextSibling),i},this.on=function(e,n,i){t.addEventListener(e,function(t){n(t),(void 0===i||i)&&t.preventDefault()})},this.toggle=function(t,n,i){var r=new e(n,i);this.on(t,function(){r.next()})},this.detach=function(){return t.parentNode.removeChild(this.obj),this},this.remove=function(){t.parentNode.removeChild(this.obj)},this.show=function(){t.style.display="block"},this.hide=function(){t.style.display="none"},this.setText=function(e){t.textContent=e},this.setHtml=function(e){t.innerHTML=e},this.blur=function(){t.blur()},this.focus=function(){t.focus()},this.scrollIntoView=function(e){t.scrollIntoView(e)},this.checked=function(){return t.checked},this.setAttribute=function(e,n){t.setAttribute(e,n)},this.getAttribute=function(e){return t.getAttribute(e)},this.classList=t.classList,Object.defineProperties(this,{textContent:{get:function(){return t.textContent},set:function(e){t.textContent=e}},innerHTML:{get:function(){return t.innerHTML},set:function(e){t.innerHTML=e}},value:{get:function(){return t.value},set:function(e){t.value=e}},placeholder:{get:function(){return t.placeholder},set:function(e){t.placeholder=e}}})}var e=function(t,e){this.state=!1,this.next=function(){this.state?(this.state=!1,e(this)):(this.state=!0,t(this))},this.wait=function(){this.state=!this.state}},n=function(e,n,i){void 0===i&&(i=!0),n||(n=window.document),n instanceof t&&(n=n.obj);var r=[].slice.call(n.querySelectorAll(e),0);return 0===r.length?null:1===r.length&&i?new t(r[0]):(r=[].slice.call(r,0),r.map(function(e){return new t(e)}))};return n.htmlify=function(e){if(e instanceof t)return e;if(e instanceof window.Element)return new t(e);var i=n.new("div");return i.innerHTML=e,new t(i.firstChild)},n.new=function(t,e){var n=document.createElement(t.split(".")[0]);return t.split(".").slice(1).forEach(function(t){n.classList.add(t)}),["A","LINK"].indexOf(n.nodeName)>-1&&(n.href="#"),e||0===e||(e=""),["TEXTAREA","INPUT"].indexOf(n.nodeName)>-1?n.value=e:n.textContent=e,n},n.each=function(t,e){Array.prototype.forEach.call(document.getElementsByTagName(t),e)},n}),n("app/config",[],function(){"use strict";for(var t={css:!0,lang:(navigator.language||navigator.userLanguage).split("-")[0],"reply-to-self":!1,"require-email":!1,"require-author":!1,"reply-notifications":!1,"max-comments-top":"inf","max-comments-nested":5,"reveal-on-click":5,gravatar:!1,avatar:!0,"avatar-bg":"#f0f0f0","avatar-fg":["#9abf88","#5698c4","#e279a3","#9163b6","#be5168","#f19670","#e4bf80","#447c69"].join(" "),vote:!0,"vote-levels":null,feed:!1},e=document.getElementsByTagName("script"),n=0;n<e.length;n++)for(var i=0;i<e[n].attributes.length;i++){var r=e[n].attributes[i];if(/^data-nikas-/.test(r.name))try{t[r.name.substring(11)]=JSON.parse(r.value)}catch(e){t[r.name.substring(11)]=r.value}}return t["avatar-fg"]=t["avatar-fg"].split(" "),t}),n("app/i18n/fa",{"postbox-text":"متن نظر را اینجا وارد کنید - حداقل ۳ حرف","postbox-author":"نام (اختیاری)","postbox-email":"آدرس ایمیل (اختیاری)","postbox-website":"آدرس وب سایت (اختیاری)","postbox-preview":"پیش نمایش","postbox-edit":"ویرایش","postbox-submit":"ثبت","postbox-notification":"Subscribe to email notification of replies","num-comments":"One Comment\n{{ n }} Comments","no-comments":"هنوز نظری ثبت نشده است","atom-feed":"Atom feed","comment-reply":"پاسخ","comment-edit":"ویرایش","comment-save":"ذخیره","comment-delete":"حذف","comment-confirm":"تایید","comment-close":"بستن","comment-cancel":"لغو","comment-deleted":"نظر حذف شد.","comment-queued":"در انتظار بررسی توسط مدیریت.","comment-anonymous":"ناشناس","comment-hidden":"{{ n }} Hidden","date-now":"همین الان","date-minute":"یک دقیقه پیش\n{{ n }} دقیقه پیش","date-hour":"یک ساعت پیش\n{{ n }} ساعت پیش","date-day":"دیروز\n{{ n }} روز پیش","date-week":"هفته پیش\n{{ n }} هفته پیش","date-month":"ماه پیش\n{{ n }} ماه پیش","date-year":"سال پیش\n{{ n }} سال پیش"}),n("app/i18n",["app/config","app/i18n/fa"],function(t,e){"use strict";var n=function(t){switch(t){case"fa":return function(t,e){return t[1===e?0:1]};default:return null}},i=t.lang;n(i)||(i="fa");var r={fa:e},o=n(i),s=function(n){return t[n+"-text-"+i]||r[i][n]||e[n]||"???"};return{lang:i,translate:s,pluralize:function(t,e){var n;return n=s(t),n.indexOf("\n")>-1&&(n=o(n.split("\n"),+e)),n?n.replace("{{ n }}",+e):n}}}),n("app/count",["app/api","app/dom","app/i18n"],function(t,e,n){return function(){var i={};e.each("a",function(t){if(t.href.match&&t.href.match(/#nikas-thread$/)){var e=t.getAttribute("data-nikas-id")||t.href.match(/^(.+)#nikas-thread$/)[1].replace(/^.*\/\/[^\/]+/,"");e in i?i[e].push(t):i[e]=[t]}});var r=Object.keys(i);t.count(r).then(function(t){for(var e in i)if(i.hasOwnProperty(e))for(var o=r.indexOf(e),s=0;s<i[e].length;s++)i[e][s].textContent=n.pluralize("num-comments",t[o])})}}),e(["app/lib/ready","app/count"],function(t,e){t(function(){e()})}),n("count",function(){})}();